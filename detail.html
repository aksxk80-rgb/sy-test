<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>팀 상세 정보</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0b1020;
      color: #f5f5f5;
      margin: 0;
      padding: 20px;
    }

    h1 {
      margin-bottom: 4px;
    }

    .team-total {
      color: #fbbf24;
      margin-bottom: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.85rem;
    }

    th, td {
      border: 1px solid rgba(255,255,255,0.15);
      padding: 6px;
      text-align: center;
    }

    th {
      background: rgba(255,255,255,0.1);
    }

    .loading {
      margin-top: 40px;
      text-align: center;
      color: #9ca3af;
    }
  </style>
</head>
<body>

  <h1 id="teamName">팀 상세 정보</h1>
  <div id="teamTotal" class="team-total"></div>

  <div id="status" class="loading">데이터 불러오는 중...</div>
  <div id="tableArea"></div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const teamParam = urlParams.get("team");

    const CSV_URL =
      "https://docs.google.com/spreadsheets/d/1CQOwFcg-lpUQ77ot8-6FhG4D6b4zxd6yo-bkpHjHetU/export?format=csv&gid=28014312";

    document.getElementById("teamName").innerText = teamParam + " 팀 상세 정보";

    async function loadDetail() {
      try {
        const res = await fetch(CSV_URL);
        const text = await res.text();

        const rows = text
          .split("\n")
          .map(r => r.split(",").map(c => c.replace(/"/g, "").trim()));

        // 실제 헤더는 두 번째 줄
        const header = rows[1].slice(1); 
        // 팀명, 번호, 참가자, 1~18, 총점, 팀합산

        let teamRows = [];
        let currentTeam = "";

        for (let i = 2; i < rows.length; i++) {
          const row = rows[i];

          if (!row || row.length < 5) continue;

          const teamName = row[1] ? row[1].trim() : "";
          const number = row[2];
          const name = row[3];

          // 팀명 있는 줄이면 업데이트
          if (teamName) currentTeam = teamName;

          // 현재 팀이 우리가 찾는 팀이면 push
          if (currentTeam === teamParam) {
            teamRows.push(row);
          }
        }

        if (teamRows.length === 0) {
          document.getElementById("status").innerText = "해당 팀 데이터를 찾을 수 없습니다.";
          return;
        }

        // 팀 총합 (첫 줄 마지막 컬럼)
        const teamTotal = teamRows[0][teamRows[0].length - 1];
        document.getElementById("teamTotal").innerText = "팀 총합: " + teamTotal;

        // 표 만들기
        const table = document.createElement("table");

        const thead = document.createElement("thead");
        const headRow = document.createElement("tr");

        const headers = ["참가자", "번호"];
        for (let i = 1; i <= 18; i++) headers.push(i + "섹터");
        headers.push("총점");

        headers.forEach(h => {
          const th = document.createElement("th");
          th.innerText = h;
          headRow.appendChild(th);
        });

        thead.appendChild(headRow);
        table.appendChild(thead);

        const tbody = document.createElement("tbody");

        teamRows.forEach(row => {
          const tr = document.createElement("tr");

          const name = row[3];
          const number = row[2];

          const total = row[row.length - 2]; // 총점

          const sectors = row.slice(4, 4 + 18);

          const cells = [name, number, ...sectors, total];

          cells.forEach(c => {
            const td = document.createElement("td");
            td.innerText = c;
            tr.appendChild(td);
          });

          tbody.appendChild(tr);
        });

        table.appendChild(tbody);

        document.getElementById("status").style.display = "none";
        document.getElementById("tableArea").appendChild(table);

      } catch (e) {
        document.getElementById("status").innerText = "데이터 로딩 실패";
      }
    }

    loadDetail();
  </script>

</body>
</html>