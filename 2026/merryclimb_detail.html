<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>팀 상세 정보</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0b1020;
      color: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    h1 { margin-bottom: 4px; }
    .team-total { color: #fbbf24; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.85rem; }
    th, td { border: 1px solid rgba(255,255,255,0.15); padding: 6px; text-align: center; }
    th { background: rgba(255,255,255,0.1); }
    .loading { margin-top: 40px; text-align: center; color: #9ca3af; }
  </style>
</head>
<body>

  <h1 id="teamName">팀 상세 정보</h1>
  <div id="teamTotal" class="team-total"></div>

  <div id="status" class="loading">데이터 불러오는 중...</div>
  <div id="tableArea"></div>

  <script>
const urlParams = new URLSearchParams(window.location.search);
const teamParam = urlParams.get("team");

const CSV_URL =
  "https://docs.google.com/spreadsheets/d/1BgeBpjbcBa3b-k9rBhpygxIYKOgNSH81Z71p1a-D1N8/export?format=csv&gid=28014312";

document.getElementById("teamName").innerText = teamParam + " 팀 상세 정보";

const normalize = s => (s || "").replace(/"/g, "").replace(/\s+/g, "").trim();

async function loadDetail() {
  try {
    const res = await fetch(CSV_URL);
    const text = await res.text();

    const rows = text
      .replace(/\r\n/g, "\n")
      .replace(/\r/g, "\n")
      .split("\n")
      .map(r => r.trim())
      .filter(r => r !== "")
      .map(r => r.split(",").map(c => c.replace(/"/g, "").trim()));

    // 헤더 행 자동 탐색 ("팀명" 포함된 줄 찾기)
    const headerRowIndex = rows.findIndex(r => r.includes("팀명") && r.includes("참가자"));
    const header = rows[headerRowIndex];
    const dataRows = rows.slice(headerRowIndex + 1);

    const teamIdx = header.findIndex(h => h.includes("팀명"));
    const numberIdx = header.findIndex(h => h.includes("번호"));
    const nameIdx = header.findIndex(h => h.includes("참가자"));
    const totalIdx = header.findIndex(h => h.includes("총점"));
    const teamTotalIdx = header.findIndex(h => h.includes("팀합산"));

    let teamRows = [];
    let currentTeam = "";

    for (let row of dataRows) {
      if (!row || row.length < 5) continue;

      const teamName = row[teamIdx] || "";
      if (teamName) currentTeam = teamName;

      if (normalize(currentTeam) === normalize(teamParam)) {
        teamRows.push(row);
      }
    }

    if (teamRows.length === 0) {
      document.getElementById("status").innerText = "해당 팀 데이터를 찾을 수 없습니다.";
      return;
    }

    // 팀 총합 표시
    const teamTotal = teamRows[0][teamTotalIdx];
    document.getElementById("teamTotal").innerText = "팀 총합: " + teamTotal;

    // ... 표 생성 부분 동일 ...
  } catch (e) {
    document.getElementById("status").innerText = "데이터 로딩 실패";
    console.error(e);
  }
}

loadDetail();
</script>

</body>
</html>
