<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>2026 개인전 스코어보드</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .card { border: 1px solid #ccc; padding: 10px; margin: 10px 0; cursor: pointer; }
    .card:hover { background: #f0f0f0; }
  </style>
</head>
<body>
  <h1>2026 개인전 스코어보드</h1>
  <div id="status">데이터 로딩 중...</div>
  <div id="board"></div>

  <script>
    // ⭐ 강남점 실제 CSV URL
    const sheetUrl =
      "https://docs.google.com/spreadsheets/d/1EyTd9ypfTUPwYxQECAtvFZWsE87-FBG2ef6I3cDoc2o/export?format=csv&gid=914454642";

    fetch(sheetUrl)
      .then(res => res.text())
      .then(text => {
        const rows = text.trim().split("\n").map(r => r.split(","));
        const header = rows[0].split(",");

        // ⭐ 시트 헤더에 맞게 인덱스 설정
        const rankIdx = header.indexOf("팀 순위");
        const nameIdx = header.indexOf("팀명");
        const totalIdx = header.indexOf("총점");

        const items = rows.slice(1)
          .map(cols => {
            const rank = cols[rankIdx]?.trim();
            const name = cols[nameIdx]?.trim();
            const total = cols[totalIdx]?.trim();

            if (!rank || !name) return null;

            return {
              rank: Number(rank),
              displayName: name,
              teamKeyName: name,
              total
            };
          })
          .filter(Boolean)
          .sort((a, b) => a.rank - b.rank);

        const boardEl = document.getElementById("board");
       const statusEl = document.getElementById("status");
  const boardEl = document.getElementById("board");

  try {
    const res = await fetch(CSV_URL);
    const text = await res.text();

    let rows = text
      .replace(/\r\n/g, "\n")
      .replace(/\r/g, "\n")
      .split("\n")
      .map(r => r.replace(/^\uFEFF/, "").trim())
      .filter(r => r !== "");

    // ⭐ 1) 헤더가 있는 줄을 자동으로 찾기
    const headerRow = rows.find(r => r.includes("팀 순위"));
    if (!headerRow) {
      statusEl.textContent = "헤더(팀 순위)를 찾을 수 없습니다.";
      return;
    }

    const header = headerRow.split(",");

    // ⭐ 2) 헤더 인덱스 자동 매칭
    const rankIdx = header.findIndex(h => h.includes("팀 순위"));
    const nameIdx = header.findIndex(h => h.includes("팀명"));
    const totalIdx = header.findIndex(h => h.includes("총점"));

    // ⭐ 3) 헤더 줄 이후의 데이터만 사용
    const startIndex = rows.indexOf(headerRow) + 1;
    const dataRows = rows.slice(startIndex).map(r => r.split(","));

    let items = dataRows
      .map(cols => {
        const rank = cols[rankIdx]?.trim();
        const name = cols[nameIdx]?.trim();
        const total = cols[totalIdx]?.trim();
        if (!rank || !name) return null;
        return {
          rank: Number(rank),
          displayName: name,
          teamKeyName: name,
          total
        };
      })
      .filter(Boolean)
      .sort((a, b) => a.rank - b.rank);

    boardEl.innerHTML = "";
    statusEl.textContent = "";

    if (!items.length) {
      statusEl.textContent = "표시할 데이터가 없습니다.";
      return;
    }

    items.forEach(item => {
      const card = document.createElement("div");
      card.className = "card";

      card.onclick = () => {
        window.location.href = `/sy-test/2026/merryclimb_detail.html?team=${encodeURIComponent(item.teamKeyName)}`;
      };

      card.innerHTML = `
        <div class="card-left">
          <div class="rank-badge">${item.rank}위</div>
          <div>
            <div class="team-name">${item.displayName}</div>
            <div class="team-sub">팀ID: ${item.teamKeyName}</div>
          </div>
        </div>
        <div class="card-right">
          <div class="score">${item.total}</div>
          <div class="score-label">팀 점수</div>
        </div>
      `;

      boardEl.appendChild(card);
    });

  } catch (err) {
    statusEl.textContent = "점수판을 불러오는 중 오류가 발생했습니다.";
  }
}


        items.forEach(item => {
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `<strong>${item.rank}위</strong> - ${item.displayName} (${item.total}점)`;

          // ⭐ 절대 경로로 detail 페이지 이동
          card.onclick = () => {
            window.location.href =
              `/sy-test/2026/merryclimb_detail.html?team=${encodeURIComponent(item.teamKeyName)}`;
          };

          boardEl.appendChild(card);
        });
      })
      .catch(err => {
        document.getElementById("status").textContent = "데이터 로딩 실패";
        console.error(err);
      });
  </script>
</body>
</html>
