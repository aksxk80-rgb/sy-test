<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>íŒ€ ìƒì„¸ ì •ë³´</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0b1020;
      color: #f5f5f5;
      margin: 0;
      padding: 20px;
    }

    h1 {
      margin-bottom: 4px;
    }

    .team-total {
      color: #fbbf24;
      margin-bottom: 20px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.85rem;
    }

    th, td {
      border: 1px solid rgba(255,255,255,0.15);
      padding: 6px;
      text-align: center;
    }

    th {
      background: rgba(255,255,255,0.1);
    }

    .loading {
      margin-top: 40px;
      text-align: center;
      color: #9ca3af;
    }
  </style>
</head>
<body>

  <h1 id="teamName">íŒ€ ìƒì„¸ ì •ë³´</h1>
  <div id="teamTotal" class="team-total"></div>

  <div id="status" class="loading">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <div id="tableArea"></div>

<script>
  const urlParams = new URLSearchParams(window.location.search);
  const teamParam = urlParams.get("team") || "";

  // âœ… ìš”ì²­í•˜ì‹  gid=28014312 ì ìš© ë° ë‚´ë³´ë‚´ê¸° í˜•ì‹ ìœ ì§€
  const CSV_URL = "https://docs.google.com/spreadsheets/d/1kvBovpQTtlSROqo8euDIVurr8v5MTKiQBd4-gFyXHe4/export?format=csv&gid=28014312";

  if (teamParam) {
    document.getElementById("teamName").innerText = teamParam + " íŒ€ ìƒì„¸ ì •ë³´";
  }

  async function loadDetail() {
    try {
      const res = await fetch(CSV_URL);
      if (!res.ok) throw new Error("ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ì˜¤ë¥˜");
      const text = await res.text();

      // ì¤„ë°”ê¿ˆ ê¸°í˜¸ ëŒ€ì‘
      const rows = text.replace(/\r\n/g, "\n").replace(/\r/g, "\n").split("\n")
        .map(r => r.split(",").map(c => c.replace(/"/g, "").trim()));

      let teamRows = [];
      let currentTeam = "";

      // CSV ë°ì´í„° íƒìƒ‰ (ì‹œíŠ¸ êµ¬ì¡°ì— ë§ì¶° 4ë²ˆì§¸ ì¤„ë¶€í„° ì‹œì‘)
      for (let i = 3; i < rows.length; i++) {
        const row = rows[i];
        if (!row || row.length < 5) continue;

        // Bì—´(ì¸ë±ìŠ¤ 1)ì— íŒ€ëª…ì´ ìˆìœ¼ë©´ ê°±ì‹ 
        const teamNameFromSheet = row[1];
        if (teamNameFromSheet) currentTeam = teamNameFromSheet;

        // ğŸ’¡ ê³µë°± ì œê±° í›„ íŒ€ëª… ë¹„êµ (ëŒ€ì¡° ì •í™•ë„ í–¥ìƒ)
        if (currentTeam.replace(/\s+/g, "") === teamParam.replace(/\s+/g, "")) {
          teamRows.push(row);
        }
      }

      if (teamRows.length === 0) {
        document.getElementById("status").innerText = "'" + teamParam + "' íŒ€ì˜ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
        return;
      }

      // ê°œì¸ ì´ì (ë§ˆì§€ë§‰ì—ì„œ ë‘ ë²ˆì§¸) ë° íŒ€ ì´í•©(ë§ˆì§€ë§‰) ì¸ë±ìŠ¤ ê³„ì‚°
      const totalIndex = teamRows[0].length - 2;
      const teamTotalIndex = teamRows[0].length - 1;
      const sectorStart = 4;
      const sectorCount = totalIndex - sectorStart;

      // íŒ€ ì´í•© í‘œì‹œ
      const teamTotalScore = teamRows[0][teamTotalIndex];
      document.getElementById("teamTotal").innerText = "íŒ€ ì´í•©: " + (teamTotalScore || "0");

      // í…Œì´ë¸” ìƒì„± ë¡œì§
      const table = document.createElement("table");
      const thead = document.createElement("thead");
      const headRow = document.createElement("tr");

      const headers = ["ì°¸ê°€ì", "ë²ˆí˜¸"];
      for (let i = 1; i <= sectorCount; i++) headers.push(i + "ì„¹í„°");
      headers.push("ê°œì¸ ì´ì ");

      headers.forEach(h => {
        const th = document.createElement("th");
        th.innerText = h;
        headRow.appendChild(th);
      });

      thead.appendChild(headRow);
      table.appendChild(thead);

      const tbody = document.createElement("tbody");
      teamRows.forEach(row => {
        const tr = document.createElement("tr");
        const name = row[3];
        const number = row[2];
        const personalTotal = row[totalIndex];
        const sectors = row.slice(sectorStart, totalIndex);

        const cells = [name, number, ...sectors, personalTotal];
        cells.forEach(c => {
          const td = document.createElement("td");
          td.innerText = c || "0";
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });

      table.appendChild(tbody);
      document.getElementById("status").style.display = "none";
      document.getElementById("tableArea").appendChild(table);

    } catch (e) {
      document.getElementById("status").innerText = "ë°ì´í„° ë¡œë”© ì‹¤íŒ¨: ì‹œíŠ¸ ì›¹ ê²Œì‹œ ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.";
      console.error(e);
    }
  }

  loadDetail();
</script>

</body>
</html>
