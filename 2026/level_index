<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg-color: #0f172a;
      --card-bg: #1e293b;
      --text-main: #f8fafc;
      --text-dim: #94a3b8;
      
      --grade-ê²€ì •: #000000;
      --grade-íšŒìƒ‰: #808080;
      --grade-ê°ˆìƒ‰: #8B4513;
      --grade-ë³´ë¼: #800080;
      --grade-ë¹¨ê°•: #FF0000;
      --highlight: rgba(251, 191, 36, 0.3); /* ê²€ìƒ‰ ê°•ì¡° ìƒ‰ìƒ */
    }

    body { 
      font-family: 'Pretendard', sans-serif; 
      background: var(--bg-color); 
      color: var(--text-main); 
      margin: 0; padding: 20px;
    }

    h1 { font-size: 1.4rem; margin-bottom: 20px; font-weight: 800; text-align: center; line-height: 1.4; }
    
    /* ğŸ” ê²€ìƒ‰ ì˜ì—­ ìŠ¤íƒ€ì¼ */
    .search-container {
      max-width: 500px;
      margin: 0 auto 20px auto;
      display: flex;
      gap: 8px;
    }

    #searchInput {
      flex: 1;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.2);
      background: rgba(255,255,255,0.05);
      color: white;
      font-size: 1rem;
    }

    #searchInput:focus {
      outline: 2px solid #fbbf24;
      background: rgba(255,255,255,0.1);
    }

    /* âœ¨ ê²€ìƒ‰ ê°•ì¡° íš¨ê³¼ */
    .highlight {
      background-color: var(--highlight) !important;
      border: 2px solid #fbbf24 !important;
      transition: all 0.3s ease;
    }

    .nav { 
      display: flex; justify-content: center; gap: 8px; 
      margin-bottom: 30px; overflow-x: auto; padding: 5px;
    }
    button {
      white-space: nowrap; padding: 10px 18px; border: 1px solid #334155;
      border-radius: 8px; background: #1e293b; color: var(--text-dim);
      cursor: pointer; font-size: 14px;
    }
    button.active {
      background: #3b82f6; color: white; border-color: #3b82f6;
    }

    .grade-section {
      margin-bottom: 15px; 
      max-width: 500px; margin-left: auto; margin-right: auto;
    }

    .grade-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 800;
      font-size: 15px;
      color: white;
      transition: opacity 0.2s;
    }
    .grade-header:hover { opacity: 0.9; }
    .grade-header::after {
      content: 'â–¼';
      font-size: 12px;
      transition: transform 0.3s;
    }
    .grade-header.active::after {
      transform: rotate(180deg);
    }

    .grade-content {
      display: none;
      padding-top: 15px;
      animation: slideDown 0.3s ease-out;
    }

    .rank-card {
      background: var(--card-bg); border-radius: 12px;
      display: flex; align-items: center; 
      padding: 18px 15px; 
      margin-bottom: 10px;
      border: 1px solid rgba(255,255,255,0.05);
    }

    .rank-num-box {
      width: 65px; 
      display: flex; align-items: center; justify-content: center;
      font-weight: 900; font-size: 1rem;
      margin-right: 15px;
      color: var(--text-main);
    }
    
    .user-id { flex-grow: 1; font-weight: 600; text-align: left; font-size: 1.1rem; }
    .score { font-weight: 800; color: #10b981; font-size: 1.2rem; }
    .score-unit { font-size: 12px; color: var(--text-dim); margin-left: 2px; }

    .top-1 { border: 1.5px solid #facc15; }
    .top-1 .rank-num-box { color: #facc15; }
    .top-2 { border: 1.5px solid #cbd5e1; }
    .top-2 .rank-num-box { color: #cbd5e1; }
    .top-3 { border: 1.5px solid #f97316; }
    .top-3 .rank-num-box { color: #f97316; }

    #status { text-align: center; margin-top: 50px; color: var(--text-dim); }

    @keyframes slideDown {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* ğŸ” ìµœìƒë‹¨ ì´ë™ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
#backToTop {
  display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
  position: fixed;
  bottom: 30px;
  right: 20px;
  z-index: 99;
  width: 45px;
  height: 45px;
  background-color: #3b82f6;
  color: white;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  font-size: 20px;
  font-weight: bold;
  transition: opacity 0.3s, transform 0.3s;
}

#backToTop:hover {
  background-color: #2563eb;
  transform: scale(1.1);
}

  </style>
</head>
<body>
  <h1>ğŸ† CLIMBING PARK<br><span style="font-size:0.9rem; color:#3b82f6;">ë ˆë²¨ ì¸ì¦ì œ ì‹¤ì‹œê°„ ìˆœìœ„</span></h1>

  <div class="search-container">
    <input type="text" id="searchInput" placeholder="ì¸ìŠ¤íƒ€ ID ê²€ìƒ‰..." onkeyup="searchUser()">
  </div>

  <div class="nav">
    <button onclick="loadData('1ì£¼ì°¨', this)">1ì£¼ì°¨</button>
    <button onclick="loadData('2ì£¼ì°¨', this)">2ì£¼ì°¨</button>
    <button onclick="loadData('3ì£¼ì°¨', this)">3ì£¼ì°¨</button>
    <button onclick="loadData('4ì£¼ì°¨', this)">4ì£¼ì°¨</button>
    <button onclick="loadData('ì „ì²´', this)" class="active">ì „ì²´</button>
  </div>

  <div id="status">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  <div id="display-area"></div>

  <script>
    window.onload = function() { loadData('ì „ì²´'); };

    function loadData(week, btn) {
      if(btn) {
        document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('searchInput').value = ''; // ì£¼ì°¨ ë³€ê²½ ì‹œ ê²€ìƒ‰ì°½ ì´ˆê¸°í™”
      }
      document.getElementById('status').style.display = 'block';
      document.getElementById('display-area').innerHTML = '';

      google.script.run.withSuccessHandler(render).getRankingData(week);
    }

    function toggleSection(header) {
      const content = header.nextElementSibling;
      header.classList.toggle('active');
      content.style.display = content.style.display === 'block' ? 'none' : 'block';
    }

    /**
     * ğŸ’¡ ì¸ìŠ¤íƒ€ ID ê²€ìƒ‰ ê¸°ëŠ¥
     */
    function searchUser() {
      const input = document.getElementById('searchInput').value.toLowerCase();
      const sections = document.querySelectorAll('.grade-section');
      
      // ê°•ì¡° ë° ì—´ë¦¼ ìƒíƒœ ì´ˆê¸°í™” (ì…ë ¥ê°’ì´ ì—†ì„ ë•Œ)
      if (!input) {
        document.querySelectorAll('.rank-card').forEach(card => card.classList.remove('highlight'));
        return;
      }

      sections.forEach(section => {
        const header = section.querySelector('.grade-header');
        const content = section.querySelector('.grade-content');
        const cards = content.querySelectorAll('.rank-card');
        let found = false;

        cards.forEach(card => {
          const userId = card.querySelector('.user-id').innerText.toLowerCase();
          if (userId.includes(input)) {
            card.classList.add('highlight');
            found = true;
          } else {
            card.classList.remove('highlight');
          }
        });

        // ì‚¬ìš©ìê°€ ë°œê²¬ë˜ë©´ í•´ë‹¹ ê·¸ë ˆì´ë“œ ì•„ì½”ë””ì–¸ì„ ìë™ìœ¼ë¡œ ì—½ë‹ˆë‹¤.
        if (found) {
          header.classList.add('active');
          content.style.display = 'block';
        }
      });
    }

    function render(data) {
      document.getElementById('status').style.display = 'none';
      const area = document.getElementById('display-area');

      if (!data || data.length === 0) {
        area.innerHTML = "<p style='text-align:center'>ì°¸ì—¬ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
        return;
      }

      const grades = ["ê²€ì •", "íšŒìƒ‰", "ê°ˆìƒ‰", "ë³´ë¼", "ë¹¨ê°•"];
      
      grades.forEach(gradeName => {
        const gradeData = data.filter(item => item.grade === gradeName);
        if (gradeData.length === 0) return;

        const section = document.createElement('div');
        section.className = 'grade-section';
        
        section.innerHTML = `
          <div class="grade-header" style="background-color: var(--grade-${gradeName})" onclick="toggleSection(this)">
            <span>${gradeName} (${gradeData.length}ëª…)</span>
          </div>
          <div class="grade-content"></div>
        `;

        const contentArea = section.querySelector('.grade-content');

        gradeData.slice(0, 1000).forEach(item => {
          const card = document.createElement('div');
          let topClass = item.rank <= 3 ? `top-${item.rank}` : '';
          card.className = `rank-card ${topClass}`;
          
          let rankDisplay = item.rank + "ìœ„";
          if(item.rank === 1) rankDisplay = "ğŸ¥‡ 1ìœ„";
          else if(item.rank === 2) rankDisplay = "ğŸ¥ˆ 2ìœ„";
          else if(item.rank === 3) rankDisplay = "ğŸ¥‰ 3ìœ„";

          card.innerHTML = `
            <div class="rank-num-box">${rankDisplay}</div>
            <div class="user-id">${item.id}</div>
            <div class="score">${item.score}<span class="score-unit">T</span></div>
          `;
          contentArea.appendChild(card);
        });

        area.appendChild(section);
      });
    }

    // ìŠ¤í¬ë¡¤ ê°ì§€: 300px ì´ìƒ ë‚´ë ¤ì˜¤ë©´ ë²„íŠ¼ ë…¸ì¶œ
window.onscroll = function() {
  const btn = document.getElementById("backToTop");
  if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
    btn.style.display = "block";
  } else {
    btn.style.display = "none";
  }
};

// ìµœìƒë‹¨ìœ¼ë¡œ ë¶€ë“œëŸ½ê²Œ ì´ë™
function scrollToTop() {
  window.scrollTo({
    top: 0,
    behavior: 'smooth'
  });
}

  </script>
  <button id="backToTop" onclick="scrollToTop()" title="ìµœìƒë‹¨ìœ¼ë¡œ ì´ë™">â†‘</button>

</body>
</html>
